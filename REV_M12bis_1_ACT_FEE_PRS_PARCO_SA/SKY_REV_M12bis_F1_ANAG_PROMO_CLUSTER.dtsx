<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="10/29/2012 5:57:35 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="HYPSRV-SVIL01"
  DTS:CreatorName="SKY\vennia"
  DTS:DTSID="{86FD65DA-67E8-4EDE-AEBA-86141EABD485}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="14.0.3002.113"
  DTS:LocaleID="1033"
  DTS:ObjectName="SKY_REV_M01_SCONTI_F2_S2_CALCOLO_SCONTO"
  DTS:PackageType="5"
  DTS:VersionBuild="30"
  DTS:VersionGUID="{03EC5460-84D5-490F-A043-116C4AB0EDF6}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[ICO_MONITOR]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{0BCE7DF3-46A1-4865-8751-BADBD3A649F8}"
      DTS:ObjectName="ICO_MONITOR">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=SQL02;Initial Catalog=ICO_MONITOR;Provider=SQLNCLI11;Integrated Security=SSPI;Auto Translate=False;Application Name=SSIS-SKY_REV_M01_SCONTI_F2_S2_CALCOLO_SCONTO-{0BCE7DF3-46A1-4865-8751-BADBD3A649F8}ICO_MONITOR;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[SKY_REV]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{9BA6D439-F86A-4779-8668-AA52BB26DDF4}"
      DTS:ObjectName="SKY_REV">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=SQL02;User ID=HYPSYS9_CONSOLE;Initial Catalog=SKY_REV;Provider=SQLNCLI11;Integrated Security=SSPI;Auto Translate=False;Application Name=SSIS-SKY_REV_M01_SCONTI_F2_S2_CALCOLO_SCONTO-{9BA6D439-F86A-4779-8668-AA52BB26DDF4}SKY_REV;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="ICO_MONITOR"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{6295ECB1-2395-46AA-85B7-BE8D3804BAA3}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">6,7,OnError,13,OnPostExecute,14,OnPostValidate,12,OnPreExecute,13,OnPreValidate,12,OnTaskFailed</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:Property
      DTS:EventName="OnPostExecute"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:Property
      DTS:EventName="OnPostValidate"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:Property
      DTS:EventName="OnPreExecute"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:Property
      DTS:EventName="OnPreValidate"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:Property
      DTS:EventName="OnTaskFailed"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{6295ECB1-2395-46AA-85B7-BE8D3804BAA3}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\populate L_REV_PRS_ACTFEE_PROMO_PARCO"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{7cbd9fd4-67f0-4757-87f4-8a05cc79717d}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="populate L_REV_PRS_ACTFEE_PROMO_PARCO"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{9BA6D439-F86A-4779-8668-AA52BB26DDF4}"
          SQLTask:SqlStatementSource="IF OBJECT_ID('ST_REV_PRS_ACTFEE_PROMO', 'U') IS NOT NULL &#xA;  DROP TABLE ST_REV_PRS_ACTFEE_PROMO; &#xA;&#xA; &#xA;&#xA;  IF OBJECT_ID('STT_REV_PRS_ACTFEE_PROMO', 'U') IS NOT NULL &#xA;  DROP TABLE STT_REV_PRS_ACTFEE_PROMO; &#xA;&#xA; &#xA;&#xA;SELECT distinct  a.COD_PROMO_TEC , a.PRT_DES as PRS_L00,COD_PROMO_SKY +' - ' + +NOME_PROMO as COD_PROMO_SKY,case when  a.PROMO_CLUSTER is null then '***-NO_PROMO_PARCO_CLUSTER' else a.PROMO_CLUSTER end as PRS_L01 , case when a.PROMO_TYPE is null then  'Discounts on PS Parco'  else 'Discounts on ' +a.PROMO_TYPE end  as PRS_l02 &#xA;into ST_REV_PRS_ACTFEE_PROMO&#xA;  FROM [SKY_REV].[dbo].[L_REV_PRS_ACTFEE_PROMO] s&#xA;  right join (&#xA;&#xA; &#xA;&#xA;select distinct COD_PROMO_TEC, a.PRT_DES,PROMO_WEEKLY_RGR, PROMO_CLUSTER, PROMO_TYPE,COD_PROMO_SKY,NOME_PROMO from (&#xA;    select distinct COD_PROMO_TEC, a.PRT_DES, a.COD_PROMO_SKY,a.NOME_PROMO,sf.GIO_ID, sf.ACC_ID,&#xA;    --a.TECNOLOGIA,&#xA;    a.CATEGORIA_RC,FLAG_MOTORE_SCONTI, PROMO_TYPE, PROMO_WEEKLY_RGR, PROMO_CLUSTER&#xA;    &#xA;     from&#xA;        (&#xA;        SELECT&#xA;            rs.ACCOUNT, rs.COD_PROMO_TEC, prt.PRT_DES, rs.COD_PROMO_SKY, prs.NOME_PROMO, rs.CATEGORIA_RC, rs.RC_COD, rs.RC_DESCR,  rs.VALORE&#xA;            --,rs.COD_LISTINO, rs.DATA_ATT,&#xA;             ,rs.DATA_ATT_RC&#xA;            --,atps.ACCOUNT    as &quot;CHECK__ATPS&quot;&#xA;            ,rs.TECNOLOGIA&#xA;            ,CASE &#xA;                WHEN promo.COD_PROMO_TEC is null THEN 0 &#xA;                ELSE 1 end as FLAG_MOTORE_SCONTI&#xA;            ,promo.PROMO_TYPE&#xA;            ,promo.PROMO_WEEKLY_RGR&#xA;            ,promo.PROMO_CLUSTER&#xA;            &#xA;        FROM &#xA;            T_REV_DTRS                    rs&#xA;        LEFT JOIN &#xA;            (&#xA;                Select &#xA;                    distinct ACCOUNT,COD_PROMO_TEC &#xA;                from T_REV_DT_B10_ATPS&#xA;            union&#xA;                Select &#xA;                    distinct ACCOUNT,COD_PROMO_TEC &#xA;                from T_REV_DT_B10_ATPSQ&#xA;            )                            atps    on atps.ACCOUNT = rs.ACCOUNT and atps.COD_PROMO_TEC = rs.COD_PROMO_TEC&#xA;        LEFT JOIN&#xA;            (&#xA;            select&#xA;                wtt.COD_PROMO_TEC&#xA;                ,promo.PROMO_TYPE, promo.PROMO_WEEKLY_RGR, promo.PROMO_CLUSTER&#xA;            from &#xA;                WTT_REV_RC_ATTIVATI_STEP4 wtt&#xA;            left join&#xA;                S_PROMO                    promo    on promo.PROMO_ID = wtt.COD_PROMO_TEC&#xA;            where&#xA;                1=1&#xA;                and (wtt.COD_PROMO_TEC not like '%0000' or wtt.COD_PROMO_TEC not like '%6666')&#xA;            )                            promo    on promo.COD_PROMO_TEC = rs.COD_PROMO_TEC&#xA;        LEFT JOIN &#xA;            T_REV_PRT_PROMO_TECNICA        prt        on rs.COD_PROMO_TEC = prt.PRT_ID&#xA;        LEFT JOIN &#xA;            (&#xA;            select&#xA;                distinct * &#xA;            from &#xA;                T_REV_PRS_PROMO_SKY&#xA;            )                            prs        on rs.COD_PROMO_SKY = prs.COD_PROMO_SKY&#xA;        WHERE &#xA;            1=1&#xA;            and CATEGORIA_RC in ('Contributo Att. standard','Sconto Contr. di att.standard','Contributo Att. Premium Serv.','Sconto Contributo Att. Premium')&#xA;            and atps.ACCOUNT is null&#xA;            ------------------------------&#xA;            --Verifica FLAG_MOTORE_SCONTI (ossia tutti qui ratecode che non matchano con la tabella &quot;WTT_REV_RC_ATTIVATI_STEP4&quot;)&#xA;            --and promo.COD_PROMO_TEC is null&#xA;            ------------------------------&#xA;            --Caso&#xA;            --and rs.ACCOUNT = 13681168&#xA;            ------------------------------&#xA;        ) a&#xA;    left join &#xA;        SKY_SA.dbo.SF_SBF_FIRSTACT sf    &#xA;        on sf.ACC_ID = a.ACCOUNT and sf.GIO_ID=a.DATA_ATT_RC &#xA;        &#xA;)&#xA; a&#xA; where a.ACC_ID is null&#xA; --691&#xA;  &#xA;&#xA; &#xA;&#xA;&#xA; ) a &#xA; on  s.PRS_L00 = a.PRT_DES&#xA; where PRS_L00 is null&#xA;&#xA; &#xA;&#xA; &#xA;&#xA; &#xA;select distinct  COD_PROMO_TEC,PROMO_DES as prs_l00, sky.COD_PROMO_SKY +' - ' + +NOME_PROMO as COD_PROMO_SKY, PROMO_CLUSTER as PRS_l01, PROMO_TYPE as PRS_l02 &#xA;into STT_REV_PRS_ACTFEE_PROMO&#xA;from S_REV_PRS_ACTFEE_PROMO s&#xA;left join (select distinct cod_promo_tec, cod_promo_sky from T_REV_DTRS ) rs on rs.COD_PROMO_TEC= s.PROMO_ID&#xA;join T_REV_PRS_PROMO_SKY sky on rs.COD_PROMO_SKY = sky.COD_PROMO_SKY &#xA;&#xA; &#xA;&#xA;&#xA; --truncate table L_REV_PRS_ACTFEE_PROMO_PARCO&#xA;     &#xA;MERGE INTO L_REV_PRS_ACTFEE_PROMO_PARCO WITH (HOLDLOCK) AS targ&#xA;USING STT_REV_PRS_ACTFEE_PROMO AS source&#xA;    ON targ.PRS_L00 = source.PRS_L00&#xA;--WHEN MATCHED THEN &#xA;--   select 1&#xA;WHEN NOT MATCHED BY TARGET THEN&#xA;    INSERT (COD_PROMO_TEC,COD_PROMO_SKY, PRS_L00, PRS_L01,PRS_L02)&#xA;    VALUES (source.COD_PROMO_TEC,source.COD_PROMO_SKY, source.PRS_L00, source.PRS_L01, source.PRS_L02);&#xA;&#xA;&#xA;&#xA;&#x9;MERGE INTO L_REV_PRS_ACTFEE_PROMO_PARCO WITH (HOLDLOCK) AS targ&#xA;USING ST_REV_PRS_ACTFEE_PROMO AS source&#xA;    ON targ.PRS_L00 = source.PRS_L00&#xA;--WHEN MATCHED THEN &#xA;--   select 1&#xA;WHEN NOT MATCHED BY TARGET THEN&#xA;    INSERT (COD_PROMO_TEC,COD_PROMO_SKY, PRS_L00, PRS_L01,PRS_L02)&#xA;    VALUES (source.COD_PROMO_TEC,source.COD_PROMO_SKY, source.PRS_L00, source.PRS_L01, source.PRS_L02);" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="300,42"
          Id="Package\populate L_REV_PRS_ACTFEE_PROMO_PARCO"
          TopLeft="18,24" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>